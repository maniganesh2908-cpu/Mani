<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>File Upload Manager</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      margin-top: 40px;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      width: 650px;
      max-width: 95%;
      animation: fadeIn 0.6s ease-in-out;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(-10px);}
      to {opacity: 1; transform: translateY(0);}
    }
    h2 { text-align: center; color: #333; }
    .upload-section {
      text-align: center;
      border: 2px dashed #74a9f2;
      border-radius: 12px;
      padding: 20px;
      background: #f7faff;
      margin-bottom: 20px;
    }
    .upload-section input { display: none; }
    .upload-label {
      display: inline-block;
      padding: 10px 20px;
      background: #4cafef;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
    }
    .upload-label:hover { background: #3796db; }
    button {
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: white;
      font-size: 15px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.3s;
    }
    .upload-btn { background: #28a745; }
    .upload-btn:hover { background: #218838; }
    .progress {
      margin-top: 10px;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      height: 10px;
    }
    .progress-bar {
      width: 0%;
      height: 10px;
      background: #4cafef;
      transition: width 0.3s;
    }
    .file-list h3 { margin-top: 0; }
    .file-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .file-name { font-weight: 500; }
    .file-actions button {
      margin-left: 10px;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
    }
    .download-btn { background: #007bff; }
    .download-btn:hover { background: #0069d9; }
    .delete-btn { background: #dc3545; }
    .delete-btn:hover { background: #c82333; }
    .status { margin-top: 10px; text-align: center; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìÇ File Upload Manager</h2>

    <!-- Upload Section -->
    <div class="upload-section">
      <input type="file" id="fileInput" />
      <label class="upload-label" for="fileInput">Choose File</label>
      <button class="upload-btn" id="uploadBtn">Upload</button>
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      <div class="status" id="statusMsg"></div>
    </div>

    <!-- File List -->
    <div class="file-list">
      <h3>Uploaded Files</h3>
      <div id="filesContainer"></div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const progressBar = document.getElementById("progressBar");
    const filesContainer = document.getElementById("filesContainer");
    const statusMsg = document.getElementById("statusMsg");

    uploadBtn.addEventListener("click", () => {
      if (!fileInput.files[0]) {
        alert("Please select a file first!");
        return;
      }
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "http://localhost:5000/upload");

      xhr.upload.addEventListener("progress", (e) => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent + "%";
        }
      });

      xhr.onload = () => {
        if (xhr.status === 200) {
          statusMsg.textContent = "‚úÖ Upload successful!";
          progressBar.style.width = "0%";
          fileInput.value = "";
          loadFiles();
        } else {
          statusMsg.textContent = "‚ùå Upload failed!";
        }
      };

      xhr.onerror = () => { statusMsg.textContent = "‚ùå Error uploading file."; };
      xhr.send(formData);
    });

    async function loadFiles() {
      filesContainer.innerHTML = "";
      try {
        const res = await fetch("http://localhost:5000/files");
        const data = await res.json();

        if (!data || data.length === 0) {
          filesContainer.innerHTML = "<p>No files uploaded yet.</p>";
        } else {
          data.forEach((file) => {
            const div = document.createElement("div");
            div.classList.add("file-card");
            div.innerHTML = `
              <span class="file-name">${file.fileName}</span>
              <div class="file-actions">
                <button class="download-btn" onclick="window.open('${file.fileUrl}')">Download</button>
                <button class="delete-btn" onclick="deleteFile('${file.fileId}')">Delete</button>
              </div>
            `;
            filesContainer.appendChild(div);
          });
        }
      } catch (err) {
        console.error("Error loading files:", err);
      }
    }

    async function deleteFile(id) {
      if (!confirm("Are you sure you want to delete this file?")) return;
      try {
        const res = await fetch(`http://localhost:5000/files/${id}`, { method: "DELETE" });
        const result = await res.json();
        alert(result.message || "Deleted");
        loadFiles();
      } catch (err) {
        alert("Error deleting file.");
      }
    }

    loadFiles();
  </script>
</body>
</html>
